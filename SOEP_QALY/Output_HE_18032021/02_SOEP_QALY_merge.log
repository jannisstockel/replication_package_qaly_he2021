------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\sebbs\surfdrive\Shared\SOEP _DataPreparation\SOEP_QALY\Output/02_SOEP_QALY_merge.log
  log type:  text
 opened on:  18 Mar 2021, 15:51:05

. *===============================================================================
. * BEGIN PROGRAM
. *===============================================================================
. 
. * Load in individual level extracted variables
. use             "./Data_merge/pl_ex.dta", replace
(SOEP-Core, v35, doi:10.5684/soep-core.v35)

. 
. *===============================================================================
. * Step 1: Merge background variables from individual surveys
. *===============================================================================
. 
. di in red       "Merge background variables from individual responses"
Merge background variables from individual responses

. 
. merge 1:1       pid syear using "./Data_merge/pgen_ex.dta"
(note: variable syear was long, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,603
        from master                        45  (_merge==1)
        from using                      6,558  (_merge==2)

    matched                           682,402  (_merge==3)
    -----------------------------------------

. keep            if _merge==3
(6,603 observations deleted)

. drop            _merge 

. 
. *===============================================================================
. * Step 2: Merge with household hevel hariables
. *===============================================================================
. 
. di in red  "Merge with household-level variables"
Merge with household-level variables

. 
. * Generated Variables
. merge m:1   hid syear using "./Data_merge/hgen_ex.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                           736
        from master                       703  (_merge==1)
        from using                         33  (_merge==2)

    matched                           681,699  (_merge==3)
    -----------------------------------------

. keep            if _merge==3
(736 observations deleted)

. drop        _merge

. 
. 
. *===============================================================================
. * Step 3: Merge with Health variables on the individual level
. *===============================================================================
. 
. di in red       "Merge with health questionnaire responses"
Merge with health questionnaire responses

. 
. merge 1:1       pid syear using "./Data_source/sf12health/sf12waves.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       452,978
        from master                   452,567  (_merge==1)
        from using                        411  (_merge==2)

    matched                           229,132  (_merge==3)
    -----------------------------------------

. drop            _merge

. 
. *===============================================================================
. * Step 4: Merge with Calculated HH-level number of children in age brackets 
. *===============================================================================
. 
. di in red       "Merge with HH-level number of children (calculated)"
Merge with HH-level number of children (calculated)

. 
. merge m:1       hid syear using "./Data_merge/kind_ex.dta" 

    Result                           # of obs.
    -----------------------------------------
    not matched                       524,208
        from master                   524,130  (_merge==1)
        from using                         78  (_merge==2)

    matched                           157,980  (_merge==3)
    -----------------------------------------

. drop            if _merge==2    // Drop hh not found in master file (individual responses)
(78 observations deleted)

. drop            _merge

. 
. * HH with no matched obervation from using 
. replace         oldt            =       0 if oldt               ==.
(524,130 real changes made)

. replace         youngt          =       0 if youngt             ==.
(524,130 real changes made)

. replace         childrent       =       0 if childrent  ==.
(524,130 real changes made)

. 
. *===============================================================================
. * Step 5: Merge with SF12 health utility values
. *===============================================================================
. 
. di in red       "Merge with calculated SF12 health index values"
Merge with calculated SF12 health index values

. 
. //UK tariff calculated following Brazier 2004
. merge 1:1       pid syear using "./Data_source/SOEP_final_utilities_UK.dta", keepusing(sf12ind_UK SFPhys SFRole SFSoci
> al SFPain SFMental SFVital valid mcs pcs)

    Result                           # of obs.
    -----------------------------------------
    not matched                       452,567
        from master                   452,567  (_merge==1)
        from using                          0  (_merge==2)

    matched                           229,543  (_merge==3)
    -----------------------------------------

. drop _merge

. 
. //Dutch tariff calculated following Jonkers 2018 
. merge 1:1       pid syear using "./Data_source/SOEP_final_utilities_NL.dta", keepusing(sf12ind_NL)
(label valid_EN already defined)
(label valid already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       452,567
        from master                   452,567  (_merge==1)
        from using                          0  (_merge==2)

    matched                           229,543  (_merge==3)
    -----------------------------------------

. 
. *===============================================================================
. * Remove observation before 2002
. *===============================================================================
. 
. di in red       "Remove Observations before 2002, no SF12-health questionnaire"
Remove Observations before 2002, no SF12-health questionnaire

. 
. tab             syear _merge

Erhebungsj |
       ahr |
(SurveyYea |        _merge
        r) | master on  matched ( |     Total
-----------+----------------------+----------
      1984 |    12,245          0 |    12,245 
      1985 |    11,090          0 |    11,090 
      1986 |    10,646          0 |    10,646 
      1987 |    10,516          0 |    10,516 
      1988 |    10,023          0 |    10,023 
      1989 |     9,710          0 |     9,710 
      1990 |    13,972          0 |    13,972 
      1991 |    13,669          0 |    13,669 
      1992 |    13,397          0 |    13,397 
      1993 |    13,179          0 |    13,179 
      1994 |    13,417          0 |    13,417 
      1995 |    13,768          0 |    13,768 
      1996 |    13,511          0 |    13,511 
      1997 |    13,283          0 |    13,283 
      1998 |    14,670          0 |    14,670 
      1999 |    14,085          0 |    14,085 
      2000 |    24,576          0 |    24,576 
      2001 |    22,351          0 |    22,351 
      2002 |         0     23,892 |    23,892 
      2003 |    22,592          0 |    22,592 
      2004 |         0     22,019 |    22,019 
      2005 |    21,091          0 |    21,091 
      2006 |         0     22,358 |    22,358 
      2007 |    20,869          0 |    20,869 
      2008 |         0     19,684 |    19,684 
      2009 |    20,777          0 |    20,777 
      2010 |         0     26,720 |    26,720 
      2011 |    28,691          0 |    28,691 
      2012 |         0     27,983 |    27,983 
      2013 |    30,934          0 |    30,934 
      2014 |         0     27,465 |    27,465 
      2015 |    27,108          0 |    27,108 
      2016 |         0     29,116 |    29,116 
      2017 |    32,397          0 |    32,397 
      2018 |         0     30,306 |    30,306 
-----------+----------------------+----------
     Total |   452,567    229,543 |   682,110 

. drop            if syear<2002
(248,108 observations deleted)

. drop            _merge

. 
. *===============================================================================
. * Add 2002-2018 Annual CPI Data from German Statistics Office
. *===============================================================================
. 
. di in red       "Add Consumer Price Indices for 2002-2018, from German Stats Office"
Add Consumer Price Indices for 2002-2018, from German Stats Office

. 
. merge m:1       syear using "./cpi_germanyDESTATIS_Feb2020.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           434,002  (_merge==3)
    -----------------------------------------

. drop            _merge

. 
. save            "./Data_panel/SOEP_merged_raw.dta", replace 
file ./Data_panel/SOEP_merged_raw.dta saved

. 
. *===============================================================================
. * END PROGRAM
. *===============================================================================
. capture log close
